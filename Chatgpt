import os
import csv
from statistics import variance

# The find_best_average function and other functions remain unchanged.
# ...
def find_best_average(values):
    while len(values) > 1:
        avg = sum(values) / len(values)
        var = variance(values)
        if var < 0.05:
            return avg
        else:
            values = values[1:]
    return values[0]

def process_txt_files(network_location, output_file_path):
    fieldnames = ['File_Name', 'eventId', 'EventName']
    for i in range(1, 11):
        fieldnames.extend([f'back_P0_{i}', f'lay_P0_{i}'])

    # Open the output file in 'write' mode
    with open(output_file_path, 'w', newline='') as outfile:
        csv_writer = csv.writer(outfile)
        csv_writer.writerow(fieldnames)

        # Iterate through all files in the network directory
        for filename in network_location:
            if filename.endswith('.txt'):
                txt_file_path = filename
                events = []

                with open(txt_file_path, 'r') as txtfile:
                    for line in txtfile:
                        event_data = line.strip().split(',')
                        event = {
                            'File_Name': filename,
                            'eventId': event_data[0],
                            'EventName': event_data[1],
                            'back_P0': event_data[2],
                            'lay_P0': event_data[3],
                            'Inplay': event_data[4],
                            # Add other fields as needed based on your txt file format
                        }
                        events.append(event)

                # Rest of the code remains the same as provided earlier
                # ...

def main():
    network_location = []  # Add the list of file paths from the network here
    output_file_path = '//NASWDC/Data/Betfair/Soccer/CS/ALL_outputMO_tradedVolume.csv'

    process_txt_files(network_location, output_file_path)

if __name__ == "__main__":
    main()
