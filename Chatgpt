import os
import csv
import numpy as np

network_location = '//NASWDC/Data/Betfair/Soccer/Test'
output_file = 'output.txt'
variance_threshold = 0.05

def calculate_averages(values):
    if len(values) == 0:
        return None
    return sum(values) / len(values)

def process_file(file_path):
    event_data = {
        'eventId': None,
        'eventName': None,
        'back_P0': [],
        'lay_P0': []
    }

    with open(file_path, 'r') as file:
        csv_reader = csv.DictReader(file)
        for i, row in enumerate(csv_reader):
            if row['SelectionId'] == '1096':
                if row['Inplay'] == 'True':
                    event_data['back_P0'].append(float(row['back_P0']))
                    event_data['lay_P0'].append(float(row['lay_P0']))

            if i >= 10:
                break

    return event_data

def main():
    with open(output_file, 'w') as output:
        output.write('File_Name,eventId,EventName,back_P0_1,lay_P0_1,back_P0_2,lay_P0_2,back_P0_3,lay_P0_3,back_P0_4,lay_P0_4,back_P0_5,lay_P0_5,back_P0_6,lay_P0_6,back_P0_7,lay_P0_7,back_P0_8,lay_P0_8,back_P0_9,lay_P0_9,back_P0_10,lay_P0_10\n')

        for file_name in os.listdir(network_location):
            if file_name.startswith('CS') and file_name.endswith('.txt'):
                file_path = os.path.join(network_location, file_name)
                event_data = process_file(file_path)

                if len(event_data['back_P0']) > 0 and len(event_data['lay_P0']) > 0:
                    avg_back_P0 = calculate_averages(event_data['back_P0'])
                    avg_lay_P0 = calculate_averages(event_data['lay_P0'])
                    output.write(f"{file_name},{event_data['eventId']},{event_data['eventName']},")
                    output.write(','.join(str(value) for value in event_data['back_P0']) + ',')
                    output.write(','.join(str(value) for value in event_data['lay_P0']) + ',')
                    output.write(f"{avg_back_P0},{avg_lay_P0}\n")

if __name__ == "__main__":
    main()
